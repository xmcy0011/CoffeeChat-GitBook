# æ•æ„Ÿè¯ç®—æ³•å’Œå®ç°

å¾ˆæ—©ä¹‹å‰å°±æ‰“ç®—åšè¿™ä¸€å—ï¼Œåˆšå¥½æœ€è¿‘æœ‰æ—¶é—´ç ”ç©¶ä¸€ä¸‹ã€‚ç½‘ä¸Šä¸€èˆ¬éƒ½èƒ½æ‰¾åˆ°å¾ˆå¤šèµ„æ–™ï¼Œè¿™é‡Œç®€å•è¯´ä¸€ä¸‹æˆ‘çš„ç†è§£å§ã€‚

>  PSï¼šæ‰‹æœºå·åŒ¹é…ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸å±äºæ•æ„Ÿè¯èŒƒç•´ï¼Œè¯·æ³¨æ„ã€‚

ä¸ºäº†å±è”½ä¸€äº›é»„ç‰›æ¨é”€å¹¿å‘Šï¼Œç±»ä¼¼QQã€å¾®ä¿¡ã€æ‰‹æœºå·ã€â€¦â€¦ç­‰ç­‰ï¼Œæˆ‘ä»¬å¸Œæœ›éƒ½èƒ½æ›¿æ¢ä¸º*å·ã€‚è¿™é‡Œä¸ºäº†ç®€å•èµ·è§ï¼Œä»¥å¾®ä¿¡ä¸¾ä¾‹ï¼ˆå¹¶ä¸æ˜¯æ­§è§†ï¼‰ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š

- ä¸­æ–‡
  - `ç®€ä½“å­—`ï¼šå¾®ä¿¡
  - ç¹ä½“å­—ï¼šå¾®ä¿¡
  - ç«æ˜Ÿæ–‡ï¼ˆå˜å½¢æˆ–è€…è°éŸ³ï¼‰ï¼šå¶¶ä¿¡ã€å¨ä¿¡
- ä¸­é—´å¸¦ç‰¹æ®Šç¬¦å·
  - `åŠè§’ç‰¹æ®Šç¬¦å·`ï¼ˆASCIIä»¥å†…ï¼‰ ï¼š*&! #@(){}[] ç­‰ç­‰ï¼Œå¦‚å¾® ä¿¡ï¼Œå¾®&&ä¿¡ï¼Œå¾®_ä¿¡
  - å…¨è§’ï¼ˆASCIIä»¥å¤–ï¼‰ï¼šä¸­æ–‡çš„æ ‡ç‚¹ç¬¦å·ï¼Œä¸€äº›emotionè¡¨æƒ…ç­‰ï¼Œå¦‚å¾®â€”â€”ä¿¡ï¼Œå¾®ğŸ˜Šä¿¡ã€‚
- `é¦–å­—æ¯ç¼©å†™`ï¼š
  - åŠè§’ï¼šå¦‚VXã€WXã€‚
  - å…¨è§’ï¼šï½–ï½˜ã€ï¼·ï½˜ã€‚
- â€¦â€¦

å˜åŒ–å’Œç»„åˆç¡®å®å¤ªå¤šäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®ç°çš„æ—¶å€™éœ€è¦æœ‰æ‰€å–èˆã€‚å¦‚æœæˆ‘ä»¬è¦è¿‡æ»¤`ç®€ä½“å­—ã€åŠè§’ç‰¹æ®Šç¬¦å·å’Œé¦–å­—æ¯ç¼©å†™`è¿™ä¸‰ç§æƒ…å†µçš„æ•æ„Ÿè¯ï¼Œé‚£è¦æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ

## å­—ç¬¦ä¸²æŸ¥æ‰¾KMP

å¦‚æœä¸è€ƒè™‘æ€§èƒ½ï¼Œç›´æ¥ä½¿ç”¨stringè‡ªå¸¦çš„contians()å‡½æ•°ï¼Œæœ‰å¤šå°‘ä¸ªæ•æ„Ÿè¯åšå¤šå°‘æ¬¡çš„containsæ£€æµ‹å³å¯ã€‚ä½†æ˜¯å¦‚æœè¦è¿‡æ»¤çš„æ–‡æœ¬æœ‰å‡ åƒå­—ï¼Œæ•æ„Ÿè¯æœ‰ä¸Šä¸‡ä¸ªï¼Œè¿™ä¸ªæ–¹æ¡ˆè‚¯å®šæ˜¯ä¸åˆé€‚çš„ã€‚

çœ‹ä¸€ä¸‹trieæ ‘æ˜¯å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚

## Trieæ ‘

Trieæ ‘ï¼Œå³`å­—å…¸æ ‘`æˆ–`å‰ç¼€æ ‘`ï¼Œæ˜¯ä¸€ç§æ ‘å½¢ç»“æ„ã€‚å¹¿æ³›åº”ç”¨äº`ç»Ÿè®¡å’Œæ’åºå¤§é‡çš„å­—ç¬¦ä¸²`ï¼ˆä½†ä¸ä»…é™äºå­—ç¬¦ä¸²ï¼‰ï¼Œæ‰€ä»¥`ç»å¸¸è¢«æœç´¢å¼•æ“ç³»ç»Ÿç”¨äºæ–‡æœ¬è¯é¢‘ç»Ÿè®¡`ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯`æœ€å¤§é™åº¦åœ°å‡å°‘æ— è°“çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼ŒæŸ¥è¯¢æ•ˆç‡æ¯”è¾ƒé«˜`ã€‚

Trieçš„æ ¸å¿ƒæ€æƒ³æ˜¯`ç©ºé—´æ¢æ—¶é—´ï¼Œåˆ©ç”¨å­—ç¬¦ä¸²çš„å…¬å…±å‰ç¼€æ¥é™ä½æŸ¥è¯¢æ—¶é—´çš„å¼€é”€ä»¥è¾¾åˆ°æé«˜æ•ˆç‡çš„ç›®çš„`ã€‚

![trieæ ‘](../images/trie_define.png)

### Trieæ ‘çš„åŸºæœ¬æ€§è´¨

1. æ ¹èŠ‚ç‚¹ä¸åŒ…å«å­—ç¬¦ï¼Œé™¤æ ¹èŠ‚ç‚¹å¤–æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åªåŒ…å«ä¸€ä¸ªå­—ç¬¦ï¼›

2. ä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸€èŠ‚ç‚¹ï¼Œè·¯å¾„ä¸Šç»è¿‡çš„å­—ç¬¦è¿æ¥èµ·æ¥ï¼Œä¸ºè¯¥èŠ‚ç‚¹å¯¹åº”çš„å­—ç¬¦ä¸²ï¼›

3. æ¯ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹åŒ…å«çš„å­—ç¬¦éƒ½ä¸ç›¸åŒ
4. ä»ç¬¬ä¸€å­—ç¬¦å¼€å§‹æœ‰è¿ç»­é‡å¤çš„å­—ç¬¦åªå ç”¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¯”å¦‚ä¸Šé¢çš„ to å’Œ tenï¼Œä¸­é‡å¤çš„å•è¯ t åªå ç”¨äº†ä¸€ä¸ªèŠ‚ç‚¹ã€‚

æ‰€ä»¥æ¯ä¸ªèŠ‚ç‚¹éƒ½åº”è¯¥æœ‰2ä¸ªå­—æ®µï¼š

1. `end_flagæ ‡å¿—`ï¼šæ˜¯å¦ç»“æŸï¼Œå³ä¸ºå¶å­èŠ‚ç‚¹ã€‚
2. `map<key, value>`ï¼šå­˜æ”¾å½“å‰èŠ‚ç‚¹çš„å€¼å’Œå­èŠ‚ç‚¹çš„å€¼ã€‚

### åŸºç¡€å…¥é—¨

å…ˆæ¥çœ‹ä¸€ä¸ªé¢˜ç›®ï¼š[LeetCode 208. å®ç° Trie (å‰ç¼€æ ‘)](https://leetcode-cn.com/problems/implement-trie-prefix-tree/)

 å®ç°ä¸€ä¸ª Trie (å‰ç¼€æ ‘)ï¼ŒåŒ…å« `insert`, `search`, å’Œ `startsWith` è¿™ä¸‰ä¸ªæ“ä½œã€‚

ç¤ºä¾‹:

```c++
Trie trie = new Trie();

trie.insert("apple");
trie.search("apple");   // è¿”å› true
trie.search("app");     // è¿”å› false
trie.startsWith("app"); // è¿”å› true
trie.insert("app");   
trie.search("app");     // è¿”å› true
```

è¯´æ˜:

- ä½ å¯ä»¥å‡è®¾æ‰€æœ‰çš„è¾“å…¥éƒ½æ˜¯ç”±å°å†™å­—æ¯ a-z æ„æˆçš„ã€‚
- ä¿è¯æ‰€æœ‰è¾“å…¥å‡ä¸ºéç©ºå­—ç¬¦ä¸²ã€‚

### å®ç°

æˆ‘ä»¬å…ˆæ¥æŠŠå®ƒç”»æˆä¸€ä¸ªtrieæ ‘ï¼ˆä»¥é¢˜ç›®ä¸­çš„appleå’Œapp2ä¸ªå•è¯ä¸ºä¾‹ï¼‰ï¼š

![trie_leetcode_208](../images/trie_leetcode_208.png)

é€šè¿‡`insert(â€appleâ€œ)`å’Œ `insert("appâ€œ)`2æ¬¡å‡½æ•°è°ƒç”¨ï¼Œæˆ‘ä»¬æ„å»ºäº†å¦‚ä¸Šå›¾æ‰€ç¤ºçš„trieæ ‘ã€‚æˆ‘ä»¬å‘ç°ï¼š

- appleå’Œappå…±ç”¨1ä¸ªå‰ç¼€ï¼Œæ²¡æœ‰å¤šä½™çš„èŠ‚ç‚¹åˆ›å»ºï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ª#ç»“æŸèŠ‚ç‚¹ã€‚
- æœ‰2ä¸ª#èŠ‚ç‚¹ï¼Œåªè¦é‡åˆ°#å°±ä»£è¡¨æœ¬æ¬¡åŒ¹é…ç»“æŸï¼Œæœ‰å¤šå°‘ä¸ªå…³é”®è¯å°±åº”è¯¥æœ‰å¤šå°‘ä¸ª#èŠ‚ç‚¹ã€‚

å½“ç„¶ï¼Œå¢åŠ ç»“æŸèŠ‚ç‚¹çš„å¦å¤–ä¸€ä¸ªå¥½å¤„ï¼š`æˆ‘ä»¬å¯ä»¥åˆ¤æ–­æ˜¯startsWithè¿˜æ˜¯equal`ã€‚

#### æ•°æ®ç»“æ„å®šä¹‰

å› ä¸ºrootä¸åŒ…å«å­—ç¬¦ï¼Œæ‰€ä»¥å¯ä»¥åˆ†åˆ«å®šä¹‰ä¸€ä¸ªTrieNodeä»£è¡¨èŠ‚ç‚¹ï¼ŒTrieä»£è¡¨æ ‘ã€‚

**TrieNode**ï¼š

```c++
#include <string>
#include <unordered_map>

// ä»£è¡¨ä¸€ä¸ªèŠ‚ç‚¹
class TrieNode {
public:
  // æ·»åŠ å­èŠ‚ç‚¹
  void addSubNode(const char &c, TrieNode *subNode) { 
    subNodes_[c] = subNode; 
  }

  // è·å–å­èŠ‚ç‚¹
  TrieNode *getSubNode(const char &c) { 
    return subNodes_[c];
  }

private:
  // å­èŠ‚ç‚¹å­—å…¸(keyæ˜¯ä¸‹çº§å­—ç¬¦ï¼Œvalueæ˜¯ä¸‹çº§èŠ‚ç‚¹)
  std::unordered_map<char, TrieNode *> subNodes_;
};
```



**Trie**ï¼š

```c++
// ä»£è¡¨ä¸€é¢—Trieæ ‘
class Trie {
public:
  // Inserts a word into the trie.
  void insert(std::string word);

  // Returns if the word is in the trie.
  bool search(std::string word);

  // Returns if there is any word in the trie that starts with the given prefix.
  bool startsWith(std::string prefix);
  
private:
  TrieNode *root_; // rootèŠ‚ç‚¹ï¼Œä¸å­˜å‚¨å­—ç¬¦
};
```

#### insertå®ç°

é‡Œé¢æœ‰ä¸€ä¸ªrootå­—æ®µï¼Œä»£è¡¨æ ¹èŠ‚ç‚¹ï¼Œå†çœ‹ä¸€ä¸‹insertæ“ä½œï¼š

```c++
void Trie::insert(std::string word) {
  TrieNode *curNode = root_;
  // éå†å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä½œä¸ºkeyï¼ˆæ³¨æ„ä¸­æ–‡ä¸€èˆ¬æœ‰3ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ä¼šå˜æˆ3ä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯ä¸å½±å“åŒ¹é…ï¼‰
  for (int i = 0; i < word.length(); i++) {
    char c = word[i];
    TrieNode *subNode = curNode->getSubNode(c);

    // å¦‚æœæ²¡æœ‰è¿™ä¸ªèŠ‚ç‚¹åˆ™æ–°å»º
    if (subNode == nullptr) {
      subNode = new TrieNode();
      curNode->addSubNode(c, subNode);
    }
    // ä¸‹é’»ï¼ŒæŒ‡å‘å­èŠ‚ç‚¹
    curNode = subNode;
  }
  // è®¾ç½®ç»“æŸæ ‡è¯†
  curNode->addSubNode(â€˜#â€™, new TrieNode());
}
```



#### searchå®ç°

```c++
bool Trie::search(std::string word) {
  TrieNode *curNode = root_;
  for (int i = 0; i < word.length(); i++) {
    curNode = curNode->getSubNode(word[i]);
    if (curNode == nullptr)
      return false;
  }
  return curNode->getSubNode('#') != nullptr;
}
```



#### startsWithå®ç°

```c++
bool Trie::startsWith(std::string prefix) {
  TrieNode *curNode = root_;
  for (int i = 0; i < prefix.length(); i++) {
    curNode = curNode->getSubNode(prefix[i]);
    if (curNode == nullptr)
      return false;
  }
  // å’Œsearchçš„åŒºåˆ«å°±åœ¨äºè¿™é‡Œï¼Œä¸åˆ¤æ–­ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯ç»“æŸèŠ‚ç‚¹
  return true;
}
```

å¦‚æœè¿è¡Œï¼Œä¼šè¾“å‡ºå¦‚ä¸‹ç»“æœï¼š

```c++
int main() {
  Trie t;
  t.insert("apple");
  printf("%d \n", t.search("apple"));   // è¿”å› true
  printf("%d \n", t.search("app"));     // è¿”å› false
  printf("%d \n", t.startsWith("app")); // è¿”å› true
  t.insert("app");
  printf("%d \n", t.search("app"));     // è¿”å› true
  printf("%d \n", t.search("this is apple")); // è¿”å› falseï¼Œä¸ºä»€ä¹ˆï¼Ÿ
}
```

```base
$ ./main 
1 
0 
1 
1 
0 
```

æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œæœ€åä¸€ä¸ªâ€œthis is appleâ€æ˜æ˜åŒ…å«â€œappleâ€ï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯è¿”å›falseï¼Ÿ

å…¶å®å¾ˆç®€å•ï¼Œä¸Šé¢éƒ½æ˜¯`é»˜è®¤æ•æ„Ÿè¯åœ¨æ•´ä¸ªå­—ç¬¦ä¸²å¼€å§‹ä½ç½®`ï¼Œæˆ‘ä»¬`åªéœ€è¦å¢åŠ ä¸€ä¸ªæŒ‡é’ˆï¼Œä¸æ–­å¾€åæœç´¢å³å¯`ã€‚

### æ•æ„Ÿè¯æœç´¢

![trieç®—æ³•](../images/trie_algorithm_in_cpp.png)

æ€è·¯ï¼š

1. `é¦–å…ˆ p1 æŒ‡é’ˆæŒ‡å‘ root`ï¼ŒæŒ‡é’ˆ p2 å’Œ p3 æŒ‡å‘å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚
2. ç®—æ³•ä»å­—ç¬¦ t å¼€å§‹ï¼Œæ£€æµ‹æœ‰æ²¡æœ‰ä»¥ t ä½œä¸ºå‰ç¼€çš„æ•æ„Ÿè¯ï¼Œåœ¨è¿™é‡Œå°±ç›´æ¥åˆ¤æ–­ root ä¸­æœ‰æ²¡æœ‰ t è¿™ä¸ªå­èŠ‚ç‚¹å³å¯ã€‚è¿™é‡Œæ²¡æœ‰ï¼Œæ‰€ä»¥å°† p2 å’Œ p3 åŒæ—¶å³ç§»ã€‚
3. ä¸€ç›´ç§»åŠ¨p2å’Œp3ï¼Œå‘ç°å­˜åœ¨ä»¥ a ä½œä¸ºå‰ç¼€çš„æ•æ„Ÿè¯ï¼Œé‚£ä¹ˆå°±`åªå³ç§» p3 ç»§ç»­åˆ¤æ–­ p2 å’Œ p3 ä¹‹é—´çš„è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯æ•æ„Ÿè¯ï¼ˆå½“ç„¶è¦åˆ¤æ–­æ˜¯å¦å®Œæ•´ï¼‰`ã€‚å¦‚æœåœ¨å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°æ•æ„Ÿè¯ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨å…¶ä»–å­—ç¬¦ä¸²å¦‚ *** ä»£æ›¿ã€‚æ¥ä¸‹æ¥ä¸æ–­å¾ªç¯ç›´åˆ°æ•´ä¸ªå­—ç¬¦ä¸²éå†å®Œæˆå°±å¯ä»¥äº†ã€‚



ä»£ç å®ç°å¦‚ä¸‹ï¼š

```c++
bool Trie::search(std::string word) {
  // TrieNode *curNode = root_;
  // for (int i = 0; i < word.length(); i++) {
  //   curNode = curNode->getSubNode(word[i]);
  //   if (curNode == nullptr)
  //     return false;
  // }
  // return curNode->getSubNode(kEndFlag) != nullptr;

  // è½¬æ¢æˆå°å†™
  transform(word.begin(), word.end(), word.begin(), ::tolower);
  bool is_contain = false;
  for (int p2 = 0; p2 < word.length(); ++p2) {
    int wordLen = getSensitiveLength(word, p2);
    if (wordLen > 0) {
      is_contain = true;
      break;
    }
  }
  return is_contain;
}

// è¿™é‡Œå¢åŠ ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›æ•æ„Ÿè¯çš„ä½ç½®å’Œé•¿åº¦ï¼Œä¾¿äºæ›¿æ¢æˆ–è€…æ£€æµ‹é€»è¾‘
int Trie::getSensitiveLength(std::string word, int startIndex) {
  TrieNode *p1 = root_;
  int wordLen = 0;
  bool endFlag = false;

  for (int p3 = startIndex; p3 < word.length(); ++p3) {
    const char &cur = word[p3];
    auto subNode = p1->getSubNode(cur);
    if (subNode == nullptr) {
      break;
    } else {
      ++wordLen;
      // ç›´åˆ°æ‰¾åˆ°å°¾å·´çš„ä½ç½®ï¼Œæ‰è®¤ä¸ºå®Œæ•´åŒ…å«æ•æ„Ÿè¯
      if (subNode->getSubNode(kEndFlag)) {
        endFlag = true;
        break;
      } else {
        p1 = subNode;
      }
    }
  }

  // æ³¨æ„ï¼Œå¤„ç†ä¸€ä¸‹æ²¡æ‰¾åˆ°å°¾å·´çš„æƒ…å†µ
  if (!endFlag) {
    wordLen = 0;
  }
  return wordLen;
}
```

å…³äºæ—¶é—´å¤æ‚åº¦ï¼š

- æ„å»ºæ•æ„Ÿè¯çš„æ—¶é—´å¤æ‚åº¦æ˜¯å¯ä»¥å¿½ç•¥ä¸è®¡çš„ï¼Œå› ä¸ºæ„å»ºå®Œæˆåæˆ‘ä»¬æ˜¯å¯ä»¥æ— æ•°æ¬¡ä½¿ç”¨çš„ã€‚
- å¦‚æœå­—ç¬¦ä¸²çš„é•¿åº¦ä¸º nï¼Œåˆ™æ¯ä¸ªæ•æ„Ÿè¯æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸º` O(n)`ã€‚



### æ€§èƒ½æµ‹è¯•

ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬å†å¢åŠ ä¸€ä¸ªå‡½æ•°ï¼š

```c++
std::set<SensitiveWord> Trie::getSensitive(std::string word) {
  // è½¬æ¢æˆå°å†™
  transform(word.begin(), word.end(), word.begin(), ::tolower);
  std::set<SensitiveWord> sensitiveSet;

  for (int i = 0; i < word.length(); ++i) {
    int wordLen = getSensitiveLength(word, i);
    if (wordLen > 0) {
      // è®°å½•æ‰¾åˆ°çš„æ•æ„Ÿè¯çš„ç´¢å¼•å’Œé•¿åº¦
      std::string sensitiveWord = word.substr(i, wordLen);
      SensitiveWord wordObj;
      wordObj.word = sensitiveWord;
      wordObj.startIndex = i;
      wordObj.len = wordLen;

      // æ’å…¥åˆ°seté›†åˆä¸­è¿”å›
      sensitiveSet.insert(wordObj);
      i = i + wordLen - 1;
    }
  }

  return sensitiveSet;
}
```

æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š

```c++
void test_time(Trie &t) {
  auto t1 = std::chrono::steady_clock::now();
  auto r = t.getSensitive("SHitï¼Œä½ ä½ ä½ ä½ æ˜¯å‚»é€¼å•Šä½ ï¼Œè¯´ä½ å‘¢ï¼Œä½ ä¸ªå¤§ç¬¨è›‹ã€‚");
  for (auto &&i : r) {
    std::cout << "[index=" << i.startIndex << ",len=" << i.len
              << ",word=" << i.word << "],";
  }
  std::cout << std::endl;

  // run code
  auto t2 = std::chrono::steady_clock::now();
  //æ¯«ç§’çº§
  double dr_ms = std::chrono::duration<double, std::milli>(t2 - t1).count();
  std::cout << "è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰: " << dr_ms << std::endl;
}

int main() {
  Trie t;

  t.insert("ä½ æ˜¯å‚»é€¼");
  t.insert("ä½ æ˜¯å‚»é€¼å•Š");
  t.insert("ä½ æ˜¯åè›‹");
  t.insert("ä½ ä¸ªå¤§ç¬¨è›‹");
  t.insert("æˆ‘å»å¹´ä¹°äº†ä¸ªè¡¨");
  t.insert("shit");

  test_time(t);
}
```

è¾“å‡ºï¼š

```bash
$ ./main 
[index=0,len=4,word=shit],[index=16,len=12,word=ä½ æ˜¯å‚»é€¼],[index=49,len=15,word=ä½ ä¸ªå¤§ç¬¨è›‹],
è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰: 0.093765
```



æˆ‘è¿™è¾¹æ¯”è¾ƒå¥½å¥‡ï¼Œçœ‹ä¸€ä¸‹stringè‡ªå¸¦çš„findå‡½æ•°å®ç°çš„ç‰ˆæœ¬ï¼š

```c++
void test_time_by_find() {
  auto t1 = std::chrono::steady_clock::now();
  std::string origin = "SHitï¼Œä½ ä½ ä½ ä½ æ˜¯å‚»é€¼å•Šä½ ï¼Œè¯´ä½ å‘¢ï¼Œä½ ä¸ªå¤§ç¬¨è›‹ã€‚";
  std::vector<std::string> words;
  words.push_back("ä½ æ˜¯å‚»é€¼");
  words.push_back("ä½ æ˜¯å‚»é€¼å•Š");
  words.push_back("ä½ æ˜¯åè›‹");
  words.push_back("ä½ ä¸ªå¤§ç¬¨è›‹");
  words.push_back("æˆ‘å»å¹´ä¹°äº†ä¸ªè¡¨");
  words.push_back("shit");

  for (auto &&i : words) {
    size_t n = origin.find(i);
    if (n != std::string::npos) {
      std::cout << "[index=" << n << ",len=" << i.length() << ",word=" << i
                << "],";
    }
  }
  std::cout << std::endl;

  // run code
  auto t2 = std::chrono::steady_clock::now();
  //æ¯«ç§’çº§
  double dr_ms = std::chrono::duration<double, std::milli>(t2 - t1).count();
  std::cout << "è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰: " << dr_ms << std::endl;
}
```

è¾“å‡ºï¼š

```bash
$ $ ./main 
[index=0,len=4,word=shit],[index=16,len=12,word=ä½ æ˜¯å‚»é€¼],[index=49,len=15,word=ä½ ä¸ªå¤§ç¬¨è›‹],
è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰: 0.113505
[index=16,len=12,word=ä½ æ˜¯å‚»é€¼],[index=16,len=15,word=ä½ æ˜¯å‚»é€¼å•Š],[index=49,len=15,word=ä½ ä¸ªå¤§ç¬¨è›‹],[index=0,len=4,word=shit],
è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰: 0.021829
```

ä¸Šé¢é‚£ä¸ªæ˜¯trieç®—æ³•å®ç°çš„ï¼Œè€—æ—¶0.113505æ¯«ç§’ï¼Œä¸‹é¢æ˜¯stringçš„findç‰ˆæœ¬ï¼Œè€—æ—¶0.021829æ¯«ç§’ï¼Œè¿˜å¿«äº†5å€ï¼Ÿè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ

### ä¸­æ–‡æ›¿æ¢ä¸º*çš„å®ç°

é€šè¿‡ `getSensitive()` å‡½æ•°ï¼Œæˆ‘ä»¬å¾—åˆ°äº†æ•æ„Ÿè¯å‡ºç°çš„ä½ç½®å’Œé•¿åº¦ï¼Œé‚£è¦æ€ä¹ˆæ›¿æ¢æˆ*å·å‘¢ï¼Ÿ

```bash
SHitï¼Œä½ ä½ ä½ ä½ æ˜¯å‚»é€¼å•Šä½ ï¼Œè¯´ä½ å‘¢ï¼Œä½ ä¸ªå¤§ç¬¨è›‹ã€‚
```

```cpp
int main() {
    Trie t;
    t.insert("ä½ æ˜¯å‚»é€¼");
    t.insert("ä½ ä¸ªå¤§ç¬¨è›‹");
    t.insert("shit");

    std::string origin = "SHitï¼Œä½ ä½ ä½ ä½ æ˜¯å‚»é€¼å•Šä½ ï¼Œè¯´ä½ å‘¢ï¼Œä½ ä¸ªå¤§ç¬¨è›‹ã€‚";
    auto r = t.getSensitive(origin);

    for (auto &&i : r) {
        std::cout << "[index=" << i.startIndex << ",len=" << i.len
                  << ",word=" << i.word.c_str() << "]," << std::endl;
    }

    std::cout << t.replaceSensitive(origin) << std::endl;

    return 0;
}
```

è¿è¡Œåæˆ‘ä»¬å¾—åˆ°äº†ä¸€ç»„æ•æ„Ÿè¯çš„ä¿¡æ¯ï¼ŒåŒ…å«èµ·å§‹ä½ç½®ï¼Œé•¿åº¦ï¼š

```bash
[index=0,len=4,word=shit],
[index=16,len=12,word=ä½ æ˜¯å‚»é€¼],
[index=49,len=15,word=ä½ ä¸ªå¤§ç¬¨è›‹],
```

è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œå› ä¸ºLinuxä¸‹ä½¿ç”¨utf8ï¼Œ`1ä¸ªæ±‰å­—å®é™…å ç”¨3ä¸ªå­—èŠ‚`ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´ï¼Œæˆ‘ä»¬å¦‚æœç›´æ¥éå†è¿›è¡Œæ›¿æ¢ï¼Œä¼šå‘ç°*å¤šå‡ºäº†2å€ã€‚

```bash
# é”™è¯¯ï¼Œæ±‰å­—çš„éƒ¨åˆ†*å·ç¿»åˆ°3å€
****ï¼Œä½ ä½ ä½ ************å•Šä½ ï¼Œè¯´ä½ å‘¢ï¼Œ***************ã€‚

# æœŸæœ›
****ï¼Œä½ ä½ ä½ ****å•Šä½ ï¼Œè¯´ä½ å‘¢ï¼Œ*****ã€‚
```

åœ¨è§£å†³è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹Unicodeã€UTF8å’Œæ±‰å­—çš„å…³ç³»ã€‚

#### Unicodeç¼–ç 

> Unicodeï¼ˆ ç»Ÿä¸€ç ã€ä¸‡å›½ç ã€å•ä¸€ç ï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦é¢†åŸŸé‡Œçš„ä¸€é¡¹ä¸šç•Œæ ‡å‡†,åŒ…æ‹¬å­—ç¬¦é›†ã€ç¼–ç æ–¹æ¡ˆç­‰ã€‚Unicode æ˜¯ä¸ºäº†è§£å†³ä¼ ç»Ÿçš„å­—ç¬¦ç¼–ç æ–¹æ¡ˆçš„å±€é™è€Œäº§ç”Ÿçš„ï¼Œå®ƒä¸ºæ¯ç§è¯­è¨€ä¸­çš„æ¯ä¸ªå­—ç¬¦è®¾å®šäº†ç»Ÿä¸€å¹¶ä¸”å”¯ä¸€çš„ äºŒè¿›åˆ¶ç¼–ç ï¼Œä»¥æ»¡è¶³è·¨è¯­è¨€ã€è·¨å¹³å°è¿›è¡Œæ–‡æœ¬è½¬æ¢ã€å¤„ç†çš„è¦æ±‚ã€‚1990å¹´å¼€å§‹ç ”å‘ï¼Œ1994å¹´æ­£å¼å…¬å¸ƒã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹`It's çŸ¥ä¹æ—¥æŠ¥`çš„Unicodeç¼–ç æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ

```bash
I 0049
t 0074
' 0027
s 0073
  0020
çŸ¥ 77e5
ä¹ 4e4e
æ—¥ 65e5
æŠ¥ 62a5
```

æ¯ä¸€ä¸ªå­—ç¬¦å¯¹åº”ä¸€ä¸ªåå…­è¿›åˆ¶æ•°å­—ã€‚

è®¡ç®—æœºåªæ‡‚äºŒè¿›åˆ¶ï¼Œå› æ­¤ï¼Œä¸¥æ ¼æŒ‰ç…§unicodeçš„æ–¹å¼(UCS-2)ï¼Œåº”è¯¥è¿™æ ·å­˜å‚¨ï¼š

```bash
I 00000000 01001001
t 00000000 01110100
' 00000000 00100111
s 00000000 01110011
  00000000 00100000
çŸ¥ 01110111 11100101
ä¹ 01001110 01001110
æ—¥ 01100101 11100101
æŠ¥ 01100010 10100101
```

è¿™ä¸ªå­—ç¬¦ä¸²æ€»å…±å ç”¨äº†18ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯å¯¹æ¯”ä¸­è‹±æ–‡çš„äºŒè¿›åˆ¶ç ï¼Œå¯ä»¥å‘ç°ï¼Œè‹±æ–‡å‰9ä½éƒ½æ˜¯0ï¼æµªè´¹å•Šï¼Œæµªè´¹ç¡¬ç›˜ï¼Œæµªè´¹æµé‡ã€‚æ€ä¹ˆåŠï¼ŸUTFã€‚

#### UTF8

> UTF-8ï¼ˆ8-bit Unicode Transformation Formatï¼‰æ˜¯ä¸€ç§é’ˆå¯¹Unicodeçš„å¯å˜é•¿åº¦å­—ç¬¦ç¼–ç ï¼Œä¹Ÿæ˜¯ä¸€ç§å‰ç¼€ç ï¼Œåˆç§°ä¸‡å›½ç ã€‚ç”±Ken Thompsonäº1992å¹´åˆ›å»ºã€‚å®ƒå¯ä»¥ç”¨æ¥è¡¨ç¤ºUnicodeæ ‡å‡†ä¸­çš„ä»»ä½•å­—ç¬¦ï¼Œä¸”å…¶ç¼–ç ä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ä»ä¸ASCIIå…¼å®¹ï¼Œè¿™ä½¿å¾—åŸæ¥å¤„ç†ASCIIå­—ç¬¦çš„è½¯ä»¶æ— é¡»æˆ–åªé¡»åšå°‘éƒ¨ä»½ä¿®æ”¹ï¼Œå³å¯ç»§ç»­ä½¿ç”¨ã€‚å› æ­¤ï¼Œå®ƒé€æ¸æˆä¸ºç”µå­é‚®ä»¶ã€ç½‘é¡µåŠå…¶ä»–å­˜å‚¨æˆ–ä¼ é€æ–‡å­—çš„åº”ç”¨ä¸­ï¼Œä¼˜å…ˆé‡‡ç”¨çš„ç¼–ç ã€‚

UTF-8æ˜¯è¿™æ ·åšçš„ï¼š

1. `å•å­—èŠ‚çš„å­—ç¬¦ï¼Œå­—èŠ‚çš„ç¬¬ä¸€ä½è®¾ä¸º0`ï¼Œå¯¹äº`è‹±è¯­æ–‡æœ¬ï¼ŒUTF-8ç åªå ç”¨ä¸€ä¸ªå­—èŠ‚ï¼Œå’ŒASCIIç å®Œå…¨ç›¸åŒ`ï¼›

2. nä¸ªå­—èŠ‚çš„å­—ç¬¦(n>1)ï¼Œ`ç¬¬ä¸€ä¸ªå­—èŠ‚çš„å‰nä½è®¾ä¸º1ï¼Œç¬¬n+1ä½è®¾ä¸º0`ï¼Œåé¢å­—èŠ‚çš„`å‰ä¸¤ä½éƒ½è®¾ä¸º10`ï¼Œè¿™nä¸ªå­—èŠ‚çš„`å…¶ä½™ç©ºä½å¡«å……è¯¥å­—ç¬¦unicodeç ï¼Œé«˜ä½ç”¨0è¡¥è¶³`ã€‚

è¿™æ ·å°±å½¢æˆäº†å¦‚ä¸‹çš„UTF-8æ ‡è®°ä½ï¼š

```bash
0xxxxxxx
110xxxxx 10xxxxxx
1110xxxx 10xxxxxx 10xxxxxx
11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx
... ...
```

äºæ˜¯ï¼Œâ€It's çŸ¥ä¹æ—¥æŠ¥â€œå°±å˜æˆäº†ï¼š

```bash
I 01001001
t 01110100
' 00100111
s 01110011
  00100000
çŸ¥ 11100111 10011111 10100101
ä¹ 11100100 10111001 10001110
æ—¥ 11100110 10010111 10100101
æŠ¥ 11100110 10001010 10100101
```

å’Œä¸Šè¾¹çš„æ–¹æ¡ˆå¯¹æ¯”ä¸€ä¸‹ï¼Œè‹±æ–‡çŸ­äº†ï¼Œæ¯ä¸ªä¸­æ–‡å­—ç¬¦å´å¤šç”¨äº†ä¸€ä¸ªå­—èŠ‚ã€‚ä½†æ˜¯æ•´ä¸ªå­—ç¬¦ä¸²åªç”¨äº†17ä¸ªå­—èŠ‚ï¼Œæ¯”ä¸Šè¾¹çš„18ä¸ªçŸ­äº†ä¸€ç‚¹ç‚¹ã€‚

#### éƒ¨åˆ†æ±‰å­—ç¼–ç èŒƒå›´

| Unicodeç¬¦å·èŒƒå›´ï¼ˆåå…­è¿›åˆ¶ï¼‰    | UTF-8ç¼–ç ï¼ˆäºŒè¿›åˆ¶ï¼‰                 |
| ------------------------------ | ----------------------------------- |
| 0000 0000-0000 007Fï¼ˆ1ä¸ªå­—èŠ‚ï¼‰ | 0xxxxxxx                            |
| 0000 0080-0000 07FFï¼ˆ2ä¸ªå­—èŠ‚ï¼‰ | 110xxxxx 10xxxxxx                   |
| 0000 0800-0000 FFFFï¼ˆ3ä¸ªå­—èŠ‚ï¼‰ | 1110xxxx 10xxxxxx 10xxxxxx          |
| 0001 0000-0010 FFFFï¼ˆ4ä¸ªå­—èŠ‚ï¼‰ | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx |

ä»¥æ±‰å­—â€œä¸¥â€ä¸ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•å®ç°UTF-8ç¼–ç ã€‚

å·²çŸ¥â€œä¸¥â€çš„unicodeæ˜¯4E25ï¼ˆ100111000100101ï¼‰ï¼Œæ ¹æ®ä¸Šè¡¨ï¼Œå¯ä»¥å‘ç° 4E25å¤„åœ¨ç¬¬ä¸‰è¡Œçš„èŒƒå›´å†…ï¼ˆ0000 0800-0000 FFFFï¼‰ï¼Œå› æ­¤â€œä¸¥â€çš„UTF-8ç¼–ç éœ€è¦ä¸‰ä¸ªå­—èŠ‚ï¼Œå³æ ¼å¼æ˜¯â€œ1110xxxx 10xxxxxx 10xxxxxxâ€ã€‚

ç„¶åï¼Œä»â€œä¸¥â€çš„æœ€åä¸€ä¸ªäºŒè¿›åˆ¶ä½å¼€å§‹ï¼Œä¾æ¬¡ä»åå‘å‰å¡«å…¥æ ¼å¼ä¸­çš„xï¼Œå¤šå‡ºçš„ä½è¡¥0ã€‚è¿™æ ·å°±å¾—åˆ°äº†ï¼Œâ€œä¸¥â€çš„UTF-8ç¼–ç æ˜¯ â€œ11100100 10111000 10100101â€ï¼Œè½¬æ¢æˆåå…­è¿›åˆ¶å°±æ˜¯E4B8A5ã€‚

```bash
     100   111000   100101
1110xxxx 10xxxxxx 10xxxxxx # ä»åå¾€å‰æ”¾
1110x100 10111000 10100101 # å¤šå‡ºçš„xè¡¥0
11100100 10111000 10100101
```



#### å®ç°æ±‰å­—æ›¿æ¢ä¸º*

æ–¹æ³•ä¸€ï¼šé€šè¿‡åˆ¤æ–­ä¸­æ–‡å’Œå ç”¨å­—èŠ‚æ•°æ‰‹åŠ¨å¤„ç†

```c++
/** @fn
  * @brief linuxä¸‹ä¸€ä¸ªä¸­æ–‡å ç”¨ä¸‰ä¸ªå­—èŠ‚,windowså ä¸¤ä¸ªå­—èŠ‚
  * å‚è€ƒï¼šhttps://blog.csdn.net/taiyang1987912/article/details/49736349
  * @param [in]str: å­—ç¬¦ä¸²
  * @return
  */
std::string chinese_or_english_append(const std::string &str) {
    std::string replacement;
    //char chinese[4] = {0};
    int chinese_len = 0;
    for (int i = 0; i < str.length(); i++) {
        unsigned char chr = str[i];
        int ret = chr & 0x80;
        if (ret != 0) { // chinese: the top is 1
            if (chr >= 0x80) {
                if (chr >= 0xFC && chr <= 0xFD) {
                    chinese_len = 6;
                } else if (chr >= 0xF8) {
                    chinese_len = 5;
                } else if (chr >= 0xF0) {
                    chinese_len = 4;
                } else if (chr >= 0xE0) {
                    chinese_len = 3;
                } else if (chr >= 0xC0) {
                    chinese_len = 2;
                } else {
                    throw std::exception();
                }
            }
            // è·³è¿‡
            i += chinese_len - 1;

            //chinese[0] = str[i];
            //chinese[1] = str[i + 1];
            //chinese[2] = str[i + 2];
        } else /** ascii **/ {
        }
        replacement.append("*");
    }
    return replacement;
}

std::string Trie::replaceSensitive(const std::string &word) {
    std::set<SensitiveWord> words = getSensitive(word);
    std::string ret;
    int last_index = 0;
    for (auto &item : words) {
        std::string substr = word.substr(item.startIndex, item.len);
        std::string replacement = chinese_or_english_append(substr);

        // åŸå§‹å†…å®¹
        ret.append(word.substr(last_index, item.startIndex - last_index));

        // æ›¿æ¢å†…å®¹
        ret.append(replacement);
        last_index = item.startIndex + item.len;
    }

    // append reset
    ret.append(word.substr(last_index, word.length() - last_index));

    return ret;
}
```

`æ–¹æ³•äºŒï¼ˆæ¨èï¼‰`ï¼šä½¿ç”¨wstringä»£æ›¿stringã€‚éå†wstringæ—¶ï¼Œitemä¸ºwchar_tç±»å‹ï¼ˆ4ä¸ªå­—èŠ‚ï¼‰ï¼Œç›´æ¥ä½¿ç”¨wchar_tä½œä¸ºunordered_mapçš„keyï¼Œè¿™æ ·æ— é¡»ç‰¹æ®Šå¤„ç†ä¸­æ–‡æ›¿æ¢ä¸º*çš„é—®é¢˜ã€‚


### åœé¡¿è¯å®ç°

é‡åˆ°ç‰¹æ®Šå­—ç¬¦ï¼Œæ¯”å¦‚`å¾®&ä¿¡`ã€`å¾®-ä¿¡` ã€`å¾®&&ä¿¡`å¦‚ä½•ç»§ç»­è¯†åˆ«ï¼Ÿå…¶å®å¾ˆç®€å•ï¼Œç›´æ¥å¿½ç•¥è¯¥è¯å¾€ä¸‹æŸ¥æ‰¾å³å¯ï¼š

```c++
int Trie::getSensitiveLength(std::string word, int startIndex) {
    TrieNode *p1 = root_;
    int wordLen = 0;
    bool endFlag = false;

    for (int p3 = startIndex; p3 < word.length(); ++p3) {
        const char &cur = word[p3];
        auto subNode = p1->getSubNode(cur);
        if (subNode == nullptr) {
        		// é‡åˆ°åœé¡¿è¯ï¼Œè·³è¿‡è¯¥è¯ç»§ç»­æœç´¢å­—ç¬¦ä¸²
            if (cur == '&' ||
                cur == '-'||
                cur == ' ') {
                ++wordLen;
                continue;
            }

            break;
        } else {
            // ...
        }
    }

	  // ...
}
```



### å…¨è§’å’ŒåŠè§’å®ç°

å‚è€ƒï¼š[C/C++ -- åˆ¤æ–­å­—ç¬¦ä¸²ä¸­å­˜åœ¨ä¸­æ–‡](https://www.cnblogs.com/goul/p/10274171.html)ã€[sensitivewd-filter](https://github.com/andyzty/sensitivewd-filter)

é™¤äº†ç‰¹æ®Šç¬¦å·ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µä¼šä½¿æˆ‘ä»¬çš„è¿‡æ»¤ç®—æ³•å¤±æ•ˆï¼Œé‚£å°±æ˜¯å…¨è§’ï¼ˆé™¤ASCIIç ä¹‹å¤–çš„ï¼‰ï¼Œå¦‚ä¸‹ï¼š

- å­—æ¯å…¨è§’ï¼š
  - å¤§å†™çš„ï¼šï¼¡ï¼¢ï¼£ï¼¤ï¼¥ï¼¦ï¼§
  - å°å†™çš„ï¼šï½ï½‚ï½ƒï½„ï½…ï½†ï½‡
- ç¬¦å·ï¼š
  - ä¸­æ–‡æ ‡ç‚¹ï¼šã€ã€‘ã€ã€‚ï¼Ÿï¼ï¼ˆï¼‰â€¦â€¦â€”â€”ï¼›â€˜ç­‰ç­‰

åœ¨æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ç»å¸¸çœ‹è§ä½¿ç”¨å…¨è§’ç»•è¿‡æ•æ„Ÿè¯è¿‡æ»¤çš„ç°è±¡ï¼Œæ¯”å¦‚æ··ç”¨åŠè§’å’Œå…¨è§’ï¼šï¼¦ucï½‹ï¼ŒVã€ä¿¡ç­‰ï¼Œé‚£è¦æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ

å®é™…ä¸Šï¼Œç±»ä¼¼å¤§å°å†™å¤„ç†ä¸€æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠ`å…¨è§’å­—æ¯å’Œä¸€äº›ä¸­æ–‡ç¬¦å·`è½¬æ¢æˆ`å¯¹åº”çš„åŠè§’`å³å¯ã€‚å…¶ä»–éå¸¸è§„çš„å…¨è§’ç‰¹æ®Šç¬¦å·ï¼Œç›´æ¥åœ¨åœé¡¿è¯é‡Œé¢å¢åŠ å³å¯ã€‚

![trie_ascii_code_screenhost](../images/chapter4/trie_ascii_code_screenhost.png)

![trie_unicode_half_width_screenhost](../images/chapter4/trie_unicode_half_width_screenhost.png)

é€šè¿‡æŸ¥é˜…ä¸Šè¿°çš„ASCIIç¼–ç è¡¨å’ŒUnicodeç¼–ç è¡¨ï¼Œæˆ‘ä»¬å‘ç°ä»–ä»¬å­˜åœ¨ä¸€å®šçš„å¯¹åº”å…³ç³»ï¼š

| ASCII      | UNICODE      |
| ---------- | ------------ |
| ! ï¼ˆ0x21ï¼‰ | ï¼ï¼ˆ0xFF01ï¼‰ |
| "ï¼ˆ0x22ï¼‰  | â€œï¼ˆ0xFF02ï¼‰  |
| #ï¼ˆ0x23ï¼‰  | ï¼ƒï¼ˆ0xFF03ï¼‰ |
| ...        | ...          |
| Aï¼ˆ0x41ï¼‰  | ï¼¡ï¼ˆ0xFF21ï¼‰ |
| Bï¼ˆ0x42ï¼‰  | ï¼¢ï¼ˆ0xFF22ï¼‰ |
| ...        | ...          |
| ~ï¼ˆ0x7Eï¼‰  | ï½ï¼ˆ0xFF5Eï¼‰ |

ASCIIç ` !åˆ°~`ä¹‹é—´çš„å­—ç¬¦ï¼Œå’ŒUnicodeç ä¸­ `0xFF01åˆ°0xFF5Eå­—ç¬¦` ä¸€ä¸€å¯¹åº” ï¼Œæ‰€ä»¥å…¨è§’è½¬æ¢åˆ°åŠè§’åªéœ€è¦`å‡å»ä¸€ä¸ªå›ºå®šçš„åç§»`å³å¯ã€‚

```c++
const wchar_t kSBCCharStart = 0xFF01; // å…¨è§’ï¼
const wchar_t kSBCCharEnd = 0xFF5E; // å…¨è§’ï½
// å…¨è§’ç©ºæ ¼çš„å€¼ï¼Œå®ƒæ²¡æœ‰éµä»ä¸ASCIIçš„ç›¸å¯¹åç§»ï¼Œå¿…é¡»å•ç‹¬å¤„ç†
const wchar_t kSBCSpace = 0x3000;   // å…¨è§’ç©ºæ ¼
const wchar_t kDBCSpace = ' '; // åŠè§’ç©ºæ ¼

// ASCIIè¡¨ä¸­é™¤ç©ºæ ¼å¤–çš„å¯è§å­—ç¬¦ä¸å¯¹åº”çš„å…¨è§’å­—ç¬¦çš„ç›¸å¯¹åç§»
const wchar_t kConvertStep = kSBCCharEnd - kDBCCharEnd;

int SBCConvert::qj2bj(const wchar_t &src) {
    // åç§»ï¼Œè½¬æ¢åˆ°å¯¹åº”ASCIIçš„åŠè§’å³å¯
    if (src >= kSBCCharStart && src <= kSBCCharEnd) {
        return (wchar_t) (src - kConvertStep);
    } else if (src == kSBCSpace) { // å¦‚æœæ˜¯å…¨è§’ç©ºæ ¼
        return kDBCSpace;
    }
    return src;
}
```

ä¸Šé¢ä¸ºä»€ä¹ˆè¿”å›ä¸€ä¸ªintå€¼å‘¢ï¼Ÿ

å…¶å®æˆ‘ä»¬æ‰€çœ‹åˆ°çš„æ–‡å­—ï¼ŒèƒŒåçš„åŸç†å°±æ˜¯ä¸€ä¸²æ•°å­—ï¼ˆUnicodeç¼–ç ï¼‰è€Œå·²

```c++
// Linux ç¯å¢ƒä¸‹ï¼Œstringæ˜¯utf8ç¼–ç 
int main() {
    std::wstring str = L"ä¸¥ï½A";
    for (wchar_t &item : str) {
        int unicode = static_cast<int>(item);
        std::cout << std::hex << unicode << std::endl;
    }
    return 0;
}
```

```bash
4e25
ff5e
41
```

åŒæ ·ï¼Œä¹Ÿå¯ä»¥è½¬å›å»ï¼š

```c++
#include <string>
#include <locale>
#include <codecvt>

std::string ws2s(const std::wstring &wstr) {
    using convert_typeX = std::codecvt_utf8<wchar_t>;
    std::wstring_convert<convert_typeX, wchar_t> converterX;

    return converterX.to_bytes(wstr);
}

int main() {
    wchar_t ws[4] = {};
    ws[0] = 0x4e25;
    ws[1] = 0xff5e;
    ws[2] = 0x41;
    std::cout << ws2s(ws) << std::endl;
    return 0;
}
```

```bash
ä¸¥ï½A
```



## DFAç®—æ³•

to do.



## ACè‡ªåŠ¨æœº

to do.



## æ•æ„Ÿè¯åº“

- [ä¸­æ–‡æ•æ„Ÿè¯åº“](https://www.heywhale.com/mw/dataset/5ecf6214162df90036ddfcff/content)

- [mgck](https://github.com/chason777777/mgck)

- [textfilterï¼šæ•æ„Ÿè¯è¿‡æ»¤çš„å‡ ç§å®ç°+æŸ1wè¯æ•æ„Ÿè¯åº“](https://github.com/observerss/textfilter)

-  [sensitive-stop-wordsï¼šäº’è”ç½‘å¸¸ç”¨æ•æ„Ÿè¯ã€åœæ­¢è¯è¯åº“](https://github.com/fwwdn/sensitive-stop-words)

- [keywordfilterï¼š5Wå¤šä¸ªè¿æ³•è¯](https://github.com/k5h9999/keywordfilter)

## æ€»ç»“

ç®—æ³•æ—¶é—´å¤æ‚åº¦å¯¹æ¯”ï¼š

| KMP  | Trieæ ‘ | DFA  | ACè‡ªåŠ¨æœº |
| :--: | :--:| :--: | :--: |
| O(LenA + LenB) * m | log(n) | æœªçŸ¥ | æœªçŸ¥ |

æœ€åï¼ŒC++å®ç°çš„ä»£ç è¯·ç§»æ­¥ï¼š

- [Github-cpp-dirtyfilter](https://github.com/xmcy0011/cpp-dirtyfilter)

## å‚è€ƒ

æ–‡ç« ï¼š

- [KMP+Trie+ACè‡ªåŠ¨æœºæ€»ç»“ï¼ˆå­—ç¬¦ä¸²æ¿å­ï¼‰](https://blog.csdn.net/qq_45550375/article/details/107316304)
- [ACè‡ªåŠ¨æœº ç®—æ³•è¯¦è§£(å›¾è§£)åŠæ¨¡æ¿](https://blog.csdn.net/bestsort/article/details/82947639)
- [DFA ç®—æ³•å®ç°æ•æ„Ÿè¯è¿‡æ»¤ï¼ˆå­—å…¸æ ‘)](https://blog.csdn.net/woshiaotian/article/details/10047675)
- [å­—ç¬¦ä¸²çš„æ¨¡å¼åŒ¹é…ï¼ˆKMPï¼‰ç®—æ³•](https://blog.csdn.net/yuanlaijike/article/details/82585267)
- [kmpçš„nextæ•°ç»„å€¼å¾—æ±‚æ³•](https://blog.csdn.net/guo_love_peng/article/details/6618170)
- [ACè‡ªåŠ¨æœºæ€»ç»“ï¼ˆè¶…è¯¦ç»†æ³¨é‡Šï¼‰](https://blog.csdn.net/zhiyeegao/article/details/96317311)
- [sensitive-stop-words](https://github.com/fwwdn/sensitive-stop-words)
- [sensitivewd-filter](https://github.com/andyzty/sensitivewd-filter)
- [linuxä¸‹c/c++å®ä¾‹ä¹‹ä¹è¯†åˆ«ä¸­æ–‡å­—ç¬¦](https://blog.csdn.net/taiyang1987912/article/details/49736349)
- [Unicode å’Œ UTF-8 æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ](https://www.zhihu.com/question/23374078)
- [C/C++ -- åˆ¤æ–­å­—ç¬¦ä¸²ä¸­å­˜åœ¨ä¸­æ–‡](https://www.cnblogs.com/goul/p/10274171.html)
- [è¯¦è§£KMPç®—æ³•](https://www.cnblogs.com/yjiyjige/p/3263858.html)



è§†é¢‘ï¼š

- [Bç«™è§†é¢‘ï¼šã€Œå¤©å‹¤å…¬å¼€è¯¾ã€KMPç®—æ³•æ˜“æ‡‚ç‰ˆ](https://www.bilibili.com/video/BV1jb411V78H?from=search&seid=681342996848521042)ï¼Œç‚¹è¯„ï¼šåŠ¨ç”»ç‰›é€¼ï¼Œä½†æ˜¯è¯­é€Ÿæœ‰ç‚¹å¿«ã€‚é€‚åˆå…¥é—¨
- [Bç«™è§†é¢‘ï¼šKMPç®—æ³•è®¡ç®—nextå‡½æ•°å€¼ï¼ˆæ•™æç‰ˆï¼Œè¶…ç®€å•ï¼)](https://www.bilibili.com/video/BV12J411m74v)ï¼Œç‚¹è¯„ï¼šçœ‹å®Œä¸Šé¢ä¸€ä¸ªï¼Œçœ‹è¿™ä¸ªå¤ä¹ ä¸€ä¸‹å…¬å…±å‰ç¼€ã€‚
- [KMPå­—ç¬¦ä¸²åŒ¹é…ç®—æ³•1](https://www.bilibili.com/video/BV1Px411z7Yo)ï¼Œç‚¹è¯„ï¼šä»‹ç»å‰ç¼€æ¦‚å¿µï¼Œæ·±å…¥ç†è§£å‰åç¼€ã€‚å›¾è§£éå¸¸å½¢è±¡å¥½ç†è§£ï¼Œå¼ºçƒˆæ¨èã€‚



ç½‘ç«™ï¼š

- åœ¨çº¿unicodeå­—ç¬¦è¡¨ï¼šhttps://unicode-table.com/
- æŸ¥çœ‹å­—ç¬¦ç¼–ç ï¼šhttp://www.mytju.com/classcode/tools/encode_utf8.asp

